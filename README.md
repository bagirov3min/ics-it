# Описание структуры базы данных

## Таблицы

### dbo.SKU
Таблица SKU содержит информацию о продуктах.

| Поле       | Тип          | Описание                                |
|------------|--------------|-----------------------------------------|
| ID         | INT          | Уникальный идентификатор продукта       |
| Code       | VARCHAR(10)  | Код продукта (генерируется автоматически по шаблону "s" + ID) |
| Name       | NVARCHAR(255)| Название продукта                       |

**Ограничения:**
- Поле Code уникально

### dbo.Family
Таблица Family содержит информацию о семьях.

| Поле         | Тип          | Описание                          |
|--------------|--------------|-----------------------------------|
| ID           | INT          | Уникальный идентификатор семьи    |
| SurName      | NVARCHAR(255)| Фамилия семьи                     |
| BudgetValue  | DECIMAL(18, 2)| Бюджет семьи                      |

### dbo.Basket
Таблица Basket содержит информацию о покупках.

| Поле           | Тип          | Описание                                |
|----------------|--------------|-----------------------------------------|
| ID             | INT          | Уникальный идентификатор покупки        |
| ID_SKU         | INT          | Внешний ключ на таблицу dbo.SKU         |
| ID_Family      | INT          | Внешний ключ на таблицу dbo.Family      |
| Quantity       | INT          | Количество продукта в покупке          |
| Value          | DECIMAL(18, 2)| Стоимость покупки                      |
| PurchaseDate   | DATE         | Дата покупки (по умолчанию текущая дата)|
| DiscountValue  | DECIMAL(18, 2)| Скидка на продукт (рассчитывается в триггере) |

**Ограничения:**
- Количество и стоимость не могут быть меньше 0

## Функция

### dbo.udf_GetSKUPrice
Функция возвращает стоимость одного продукта из корзины.

**Параметры:**
- @ID_SKU INT - идентификатор продукта

**Возвращаемое значение:**
- DECIMAL(18, 2) - стоимость одного продукта

## Представление

### dbo.vw_SKUPrice
Представление возвращает атрибуты продуктов из таблицы dbo.SKU и их стоимость, используя функцию dbo.udf_GetSKUPrice.

## Процедура

### dbo.usp_MakeFamilyPurchase
Процедура обновляет бюджет семьи после покупок.

**Параметры:**
- @FamilySurName NVARCHAR(255) - фамилия семьи

## Триггер

### dbo.TR_Basket_insert_update
Триггер рассчитывает скидку на продукт при добавлении или обновлении записи в таблице dbo.Basket.
# ics-it
